<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TV Home Screen</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      width: 100vw;
      font-family: Arial, sans-serif;
      color: white;
      background-size: cover;
      background-position: center;
      transition: background-image 2s ease-in-out;
      overflow: hidden;
    }

    #datetime {
      position: absolute;
      top: 20px;
      left: 20px;
      text-align: left;
    }

    #date {
      font-size: 20px;
    }

    #time {
      font-size: 48px;
    }

    #greeting {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 28px;
      text-align: right;
    }

    #weather {
      position: absolute;
      top: 100px;
      left: 20px;
      font-size: 22px;
      background: rgba(0,0,0,0.3);
      padding: 8px 12px;
      border-radius: 8px;
    }

    #parcel {
      position: absolute;
      bottom: 20px;
      left: 20px;
      font-size: 22px;
      background: rgba(0,0,0,0.3);
      padding: 8px 12px;
      border-radius: 8px;
    }

    #city {
      position: absolute;
      bottom: 20px;
      right: 20px;
      font-size: 22px;
      background: rgba(0,0,0,0.3);
      padding: 8px 12px;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 2s;
    }

    #city.visible {
      opacity: 1;
    }

    #news {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 18px;
      text-align: center;
      background: rgba(0,0,0,0.3);
      padding: 10px 15px;
      border-radius: 10px;
      max-width: 80%;
      line-height: 1.4em;
    }
  </style>
</head>
<body>
  <div id="datetime">
    <div id="date"></div>
    <div id="time"></div>
  </div>
  <div id="greeting"></div>
  <div id="weather">Loading weather...</div>
  <div id="parcel">Loading parcel...</div>
  <div id="news">Loading news...</div>
  <div id="city"></div>

  <script>
    // ---------- Config ----------
    const CITY = "Islamabad"; // Change once and both weather + city will update
    const WEATHER_API_KEY = "your_openweathermap_api_key"; // replace with your key
    const PARCEL_API_URL = "https://your-cloudflare-worker-url"; // your worker endpoint

    // ---------- Date & Time ----------
    function updateDateTime() {
      const now = new Date();
      const options = { day: '2-digit', month: 'long', year: 'numeric' };
      document.getElementById("date").textContent = now.toLocaleDateString("en-GB", options);

      let hours = now.getHours();
      let minutes = now.getMinutes().toString().padStart(2, '0');
      let ampm = hours >= 12 ? 'PM' : 'AM';
      let displayHours = hours % 12 || 12;
      document.getElementById("time").textContent = `${displayHours}:${minutes} ${ampm}`;

      updateGreeting(hours);
    }

    function updateGreeting(hour) {
      let greeting = "Hello";
      if (hour >= 5 && hour < 12) greeting = "Good Morning";
      else if (hour >= 12 && hour < 17) greeting = "Good Afternoon";
      else if (hour >= 17 && hour < 21) greeting = "Good Evening";
      else greeting = "Good Night";
      document.getElementById("greeting").textContent = greeting;
    }

    setInterval(updateDateTime, 1000);
    updateDateTime();

    // ---------- Background Images ----------
    const backgrounds = [
      "https://picsum.photos/id/1018/1920/1080",
      "https://picsum.photos/id/1025/1920/1080",
      "https://picsum.photos/id/1035/1920/1080",
      "https://picsum.photos/id/1043/1920/1080",
      "https://picsum.photos/id/1062/1920/1080",
      "https://picsum.photos/id/1074/1920/1080",
      "https://picsum.photos/id/1084/1920/1080",
      "https://picsum.photos/id/1080/1920/1080",
      "https://picsum.photos/id/237/1920/1080",
      "https://picsum.photos/id/433/1920/1080"
    ];

    let bgIndex = 0;
    function changeBackground() {
      document.body.style.backgroundImage = `url('${backgrounds[bgIndex]}')`;
      bgIndex = (bgIndex + 1) % backgrounds.length;
    }
    setInterval(changeBackground, 10000);
    changeBackground();

    // ---------- Weather ----------
    async function fetchWeather() {
      try {
        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${CITY}&appid=${WEATHER_API_KEY}&units=metric`);
        const data = await res.json();
        if (data.main) {
          document.getElementById("weather").textContent = `${Math.round(data.main.temp)}Â°C, ${data.weather[0].description}`;
          const cityDiv = document.getElementById("city");
          cityDiv.textContent = CITY;
          cityDiv.classList.add("visible");
        }
      } catch (e) {
        document.getElementById("weather").textContent = "Weather unavailable";
      }
    }
    fetchWeather();
    setInterval(fetchWeather, 60 * 60 * 1000); // refresh every hour

    // ---------- Parcel ----------
    async function fetchParcel() {
      try {
        const res = await fetch(PARCEL_API_URL);
        const data = await res.json();
        document.getElementById("parcel").textContent = data.status || "No parcels";
      } catch (e) {
        document.getElementById("parcel").textContent = "Parcel unavailable";
      }
    }
    fetchParcel();
    setInterval(fetchParcel, 4 * 60 * 60 * 1000); // every 4 hours

    // ---------- BBC News ----------
    async function fetchNews() {
      try {
        const res = await fetch("https://api.rss2json.com/v1/api.json?rss_url=http://feeds.bbci.co.uk/news/rss.xml");
        const data = await res.json();
        if (data.items && data.items.length > 0) {
          document.getElementById("news").textContent = data.items[0].title;
        }
      } catch (e) {
        document.getElementById("news").textContent = "News unavailable";
      }
    }
    fetchNews();
    setInterval(fetchNews, 60 * 60 * 1000); // every hour
  </script>
</body>
</html>

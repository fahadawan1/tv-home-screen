<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TV Home Screen</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    width: 100vw;
    font-family: Arial, sans-serif;
    color: white;
    background-size: cover;
    background-position: center;
    transition: background-image 2s ease-in-out;
    overflow: hidden;
  }
  .overlay {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    background: rgba(0,0,0,0.4);
    z-index: 0;
  }

  #datetime {
    position: absolute;
    top: 20px;
    left: 40px;
    font-size: 28px;
    z-index: 1;
  }
  #greeting {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 40px;
    font-weight: bold;
    z-index: 1;
  }
  #temperature {
    position: absolute;
    top: 20px;
    right: 40px;
    font-size: 32px;
    display: flex;
    align-items: center;
    z-index: 1;
  }
  #temperature img {
    width: 50px;
    height: 50px;
    margin-right: 8px;
  }
  #time {
    position: absolute;
    top: 120px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 100px;
    font-weight: bold;
    font-family: 'Courier New', monospace;
    z-index: 1;
  }

  /* Parcels */
  #parcel-status {
    position: fixed;
    bottom: 20px;
    left: 20px;
    color: #fff;
    font-family: sans-serif;
    font-size: 28px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.7);
    background: rgba(0,0,0,0.0); /* transparent */
    padding: 5px 10px;
    border-radius: 10px;
    z-index: 1;
  }
  #parcel-status h2 {
    margin: 0 0 10px;
    font-size: 28px;
    font-weight: bold;
  }
  #parcel-status ul {
    margin: 0;
    padding-left: 20px;
    list-style-type: disc;
  }

  /* News */
  #news-headlines {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1;
    background: rgba(0,0,0,0.0); /* transparent */
    padding: 10px 20px;
    border-radius: 10px;
    max-width: 60%;
    color: white;
    font-size: 22px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.7);
  }
  #news-headlines ul {
    margin: 0;
    padding-left: 20px;
    list-style-type: disc;
  }

  /* Spotify */
  #spotify-widget {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1;
    background: rgba(0,0,0,0.0);
    border-radius: 10px;
    padding: 5px;
  }
  #spotify-widget iframe {
    border-radius: 10px;
  }

</style>
</head>
<body>
<div class="overlay"></div>

<div id="datetime"></div>
<div id="greeting"></div>
<div id="temperature">N/A</div>
<div id="time"></div>

<!-- Parcels -->
<div id="parcel-status">
  <h2>ðŸ“¦ My Deliveries</h2>
  <ul id="deliveries-list"><li>Loading parcels...</li></ul>
</div>

<!-- News -->
<div id="news-headlines">
  <ul id="news-list"><li>Loading news...</li></ul>
</div>

<!-- Spotify -->
<div id="spotify-widget">
  <iframe 
    src="https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M" 
    width="300" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media">
  </iframe>
</div>

<script>
/* --------- Background --------- */
const backgrounds = [
  "https://picsum.photos/id/1018/1920/1080",
  "https://picsum.photos/id/1015/1920/1080",
  "https://picsum.photos/id/1025/1920/1080",
  "https://picsum.photos/id/1043/1920/1080",
  "https://picsum.photos/id/1056/1920/1080"
];
let bgIndex = 0;
function changeBackground() {
  document.body.style.backgroundImage = `url('${backgrounds[bgIndex]}')`;
  bgIndex = (bgIndex + 1) % backgrounds.length;
}
setInterval(changeBackground, 300000); // every 5 min
changeBackground();

/* --------- Date, Time & Greeting --------- */
function updateDateTime() {
  const now = new Date();

  // Date and day
  const dayName = now.toLocaleDateString(undefined, { weekday: 'long' });
  const dateStr = now.toLocaleDateString(undefined, { day: '2-digit', month: 'long', year: 'numeric' });
  document.getElementById("datetime").innerHTML = `${dateStr}<br>${dayName}`;

  // 12-hour time
  const hours24 = now.getHours();
  const hours12 = hours24 % 12 || 12;
  const minutes = now.getMinutes().toString().padStart(2, '0');
  const ampm = hours24 >= 12 ? "PM" : "AM";
  document.getElementById("time").textContent = `${hours12}:${minutes} ${ampm}`;

  updateGreeting(hours24);
}
function updateGreeting(hour) {
  let greeting = "Hello";
  if (hour >= 5 && hour < 12) greeting = "Good Morning";
  else if (hour >= 12 && hour < 17) greeting = "Good Afternoon";
  else if (hour >= 17 && hour < 21) greeting = "Good Evening";
  else greeting = "Good Night";
  document.getElementById("greeting").textContent = greeting;
}
setInterval(updateDateTime, 1000);
updateDateTime();

/* --------- Weather --------- */
const city = "Islamabad,PK"; // change city here
const weatherApiKey = "da6e580ad304b4b55f1519d1bdb88e17";

async function fetchWeather() {
  const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${weatherApiKey}`;
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error("Network response not ok");
    const data = await response.json();
    const temp = Math.round(data.main.temp) + "&deg;C";
    const iconCode = data.weather[0].icon;
    const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
    document.getElementById("temperature").innerHTML = `<img src="${iconUrl}" alt="Weather"> ${temp}`;
  } catch(e) {
    document.getElementById("temperature").textContent = "N/A";
    console.error("Weather fetch error:", e);
  }
}
setInterval(fetchWeather, 3600000); // every 1 hour
fetchWeather();

/* --------- Parcel --------- */
const parcelApiKey = "_Cdpofi01Krb8nU5tR9izd26aKz1aeJDnhFHEbTYiU9k34QTxtmVdMbmFifuVPBhAGNCXcBOa1g";
async function fetchParcels() {
  try {
    const response = await fetch("https://api.parcel.app/external/deliveries/?filter_mode=active", {
      headers: { "api-key": parcelApiKey }
    });
    const data = await response.json();
    const list = document.getElementById("deliveries-list");
    if(data.success && data.deliveries.length > 0) {
      list.innerHTML = data.deliveries.map(d => `<li>${d.description} (${d.status_code})</li>`).join('');
    } else {
      list.innerHTML = "<li>No active parcels</li>";
    }
  } catch(e) {
    document.getElementById("deliveries-list").innerHTML = "<li>Error loading parcels</li>";
    console.error("Parcel fetch error:", e);
  }
}
setInterval(fetchParcels, 4*60*60*1000); // every 4 hours
fetchParcels();

/* --------- News --------- */
async function fetchNews() {
  const feedUrl = 'http://feeds.bbci.co.uk/news/rss.xml';
  const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}`;
  try {
    const response = await fetch(apiUrl);
    const data = await response.json();
    const newsList = document.getElementById("news-list");
    newsList.innerHTML = data.items.slice(0,1) // only 1 headline
      .map(item => `<li>${item.title}</li>`).join('');
  } catch(e) {
    console.error("News fetch error:", e);
    document.getElementById("news-list").innerHTML = "<li>Failed to load news</li>";
  }
}
setInterval(fetchNews, 60*60*1000); // every 1 hour
fetchNews();

</script>
</body>
</html>
